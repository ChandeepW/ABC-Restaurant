<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Admin Panel</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Admin Page" name="description">

    <!-- Add Bootstrap CSS for Table Styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js"></script>
</head>

<body>
    <div class="container">
        <h1 class="mt-5 text-center">Admin Panel - Booking Details</h1>
        
        <!-- Login Form -->
        <div id="loginDiv" class="mt-5">
            <h3 class="text-center">Admin Login</h3>
            <div class="form-group">
                <label for="adminEmail">Email</label>
                <input type="email" id="adminEmail" class="form-control" placeholder="Enter email">
            </div>
            <div class="form-group">
                <label for="adminPassword">Password</label>
                <input type="password" id="adminPassword" class="form-control" placeholder="Enter password">
            </div>
            <button id="adminLoginBtn" class="btn btn-primary mt-3 w-100">Login</button>
        </div>

        <!-- Booking Details Table -->
        <div id="adminContent" class="mt-5" style="display:none;">
            <h3 class="text-center">Booking List</h3>
            <table class="table table-striped mt-4">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Date & Time</th>
                        <th>Number of People</th>
                        <th>Special Requests</th>
                    </tr>
                </thead>
                <tbody id="bookingTableBody">
                    <!-- Booking data will be populated here dynamically -->
                </tbody>
            </table>
            <button id="logoutBtn" class="btn btn-danger mt-3">Logout</button>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCXIwq80fFA_UEC9lUp8eogdy0gm7uEMR8",
            authDomain: "abc-rest.firebaseapp.com",
            projectId: "abc-rest",
            storageBucket: "abc-rest.appspot.com",
            messagingSenderId: "606772076544",
            appId: "1:606772076544:web:25a6e1ce3fd9db773bb8e5",
            databaseURL: "https://abc-rest-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Admin login
        document.getElementById('adminLoginBtn').addEventListener('click', function() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    checkAdminRole(user.uid);  // Check if the user has admin privileges
                })
                .catch((error) => {
                    alert("Login failed: " + error.message);
                });
        });

        // Check if the user is an admin
        function checkAdminRole(uid) {
            const userRef = db.ref('users/' + uid);
            userRef.once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.isAdmin) {
                    // The user is an admin
                    document.getElementById('loginDiv').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                    loadBookingData();
                } else {
                    alert("Access denied: You do not have admin privileges.");
                    auth.signOut();  // Log the user out if they are not an admin
                }
            }).catch((error) => {
                alert("Error checking admin role: " + error.message);
            });
        }

        // Load booking data
        function loadBookingData() {
            const bookingTableBody = document.getElementById('bookingTableBody');
            bookingTableBody.innerHTML = '';

            const bookingsRef = db.ref('bookings/');
            bookingsRef.once('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const bookingData = childSnapshot.val();

                    const row = `
                        <tr>
                            <td>${bookingData.username}</td>
                            <td>${bookingData.email}</td>
                            <td>${bookingData.date}</td>
                            <td>${bookingData.numberOfPeople}</td>
                            <td>${bookingData.specialRequest}</td>
                        </tr>
                    `;

                    bookingTableBody.innerHTML += row;
                });
            });
        }

        // Admin logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            auth.signOut().then(() => {
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('loginDiv').style.display = 'block';
                alert("Logged out successfully.");
            });
        });
    </script>

    <!-- Add Bootstrap JS for better responsiveness -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
